import type { Meta, StoryObj } from '@storybook/nextjs-vite';
import type { ShiftDisplayRow } from '../ShiftTable';
import { StaffWeeklyShiftGrid } from './StaffWeeklyShiftGrid';

const meta: Meta<typeof StaffWeeklyShiftGrid> = {
	title: 'Admin/WeeklySchedules/StaffWeeklyShiftGrid',
	component: StaffWeeklyShiftGrid,
	parameters: {
		layout: 'padded',
	},
};

export default meta;
type Story = StoryObj<typeof StaffWeeklyShiftGrid>;

const createShift = (
	id: string,
	staffId: string | null,
	staffName: string | null,
	clientName: string,
	date: Date,
	startHour: number,
	startMinute: number,
	endHour: number,
	endMinute: number,
	serviceTypeId: 'physical-care' | 'life-support' | 'commute-support',
	status: 'scheduled' | 'canceled' = 'scheduled',
	cancelReason?: string,
	cancelCategory?: 'client' | 'staff' | 'other',
): ShiftDisplayRow => ({
	id,
	staffId,
	staffName,
	clientName,
	date,
	startTime: { hour: startHour, minute: startMinute },
	endTime: { hour: endHour, minute: endMinute },
	serviceTypeId,
	status,
	isUnassigned: staffId === null,
	cancelReason: cancelReason ?? null,
	cancelCategory: cancelCategory ?? null,
});

const baseDate = new Date('2025-01-20');

const sampleShifts: ShiftDisplayRow[] = [
	// 田中太郎のシフト
	createShift(
		'1',
		'staff-1',
		'田中太郎',
		'山田花子',
		new Date('2025-01-20'),
		9,
		0,
		11,
		0,
		'physical-care',
	),
	createShift(
		'2',
		'staff-1',
		'田中太郎',
		'佐藤次郎',
		new Date('2025-01-20'),
		14,
		0,
		16,
		0,
		'life-support',
	),
	createShift(
		'3',
		'staff-1',
		'田中太郎',
		'鈴木三郎',
		new Date('2025-01-22'),
		10,
		30,
		12,
		0,
		'commute-support',
	),
	// 佐藤次郎のシフト
	createShift(
		'4',
		'staff-2',
		'佐藤次郎',
		'山田花子',
		new Date('2025-01-21'),
		9,
		0,
		11,
		30,
		'physical-care',
	),
	createShift(
		'5',
		'staff-2',
		'佐藤次郎',
		'高橋四郎',
		new Date('2025-01-23'),
		13,
		0,
		15,
		0,
		'life-support',
	),
	// 中村五郎のシフト（キャンセル含む）
	createShift(
		'6',
		'staff-3',
		'中村五郎',
		'伊藤五郎',
		new Date('2025-01-21'),
		10,
		0,
		12,
		0,
		'commute-support',
	),
	createShift(
		'7',
		'staff-3',
		'中村五郎',
		'渡辺六郎',
		new Date('2025-01-24'),
		14,
		0,
		16,
		0,
		'physical-care',
		'canceled',
		'利用者都合',
		'client',
	),
	// 未割当シフト
	createShift(
		'8',
		null,
		null,
		'加藤七郎',
		new Date('2025-01-25'),
		9,
		0,
		11,
		0,
		'life-support',
	),
	createShift(
		'9',
		null,
		null,
		'小林八郎',
		new Date('2025-01-26'),
		13,
		0,
		15,
		0,
		'physical-care',
	),
];

export const Default: Story = {
	args: {
		shifts: sampleShifts,
		weekStartDate: baseDate,
	},
};

export const Empty: Story = {
	args: {
		shifts: [],
		weekStartDate: baseDate,
	},
};

export const SingleStaff: Story = {
	args: {
		shifts: [
			createShift(
				'1',
				'staff-1',
				'田中太郎',
				'山田花子',
				new Date('2025-01-20'),
				9,
				0,
				11,
				0,
				'physical-care',
			),
			createShift(
				'2',
				'staff-1',
				'田中太郎',
				'佐藤次郎',
				new Date('2025-01-20'),
				14,
				0,
				16,
				0,
				'life-support',
			),
			createShift(
				'3',
				'staff-1',
				'田中太郎',
				'鈴木三郎',
				new Date('2025-01-21'),
				10,
				0,
				12,
				0,
				'commute-support',
			),
			createShift(
				'4',
				'staff-1',
				'田中太郎',
				'高橋四郎',
				new Date('2025-01-22'),
				9,
				30,
				11,
				30,
				'physical-care',
			),
			createShift(
				'5',
				'staff-1',
				'田中太郎',
				'伊藤五郎',
				new Date('2025-01-23'),
				13,
				0,
				15,
				0,
				'life-support',
			),
			createShift(
				'6',
				'staff-1',
				'田中太郎',
				'渡辺六郎',
				new Date('2025-01-24'),
				10,
				0,
				12,
				0,
				'commute-support',
			),
			createShift(
				'7',
				'staff-1',
				'田中太郎',
				'加藤七郎',
				new Date('2025-01-25'),
				14,
				0,
				16,
				0,
				'physical-care',
			),
		],
		weekStartDate: baseDate,
	},
};

export const WithCanceledShifts: Story = {
	args: {
		shifts: [
			createShift(
				'1',
				'staff-1',
				'田中太郎',
				'山田花子',
				new Date('2025-01-20'),
				9,
				0,
				11,
				0,
				'physical-care',
			),
			createShift(
				'2',
				'staff-1',
				'田中太郎',
				'佐藤次郎',
				new Date('2025-01-21'),
				14,
				0,
				16,
				0,
				'life-support',
				'canceled',
				'体調不良',
				'client',
			),
			createShift(
				'3',
				'staff-2',
				'佐藤次郎',
				'鈴木三郎',
				new Date('2025-01-22'),
				10,
				0,
				12,
				0,
				'commute-support',
				'canceled',
				'スタッフ都合',
				'staff',
			),
		],
		weekStartDate: baseDate,
	},
};

export const OnlyUnassigned: Story = {
	args: {
		shifts: [
			createShift(
				'1',
				null,
				null,
				'山田花子',
				new Date('2025-01-20'),
				9,
				0,
				11,
				0,
				'physical-care',
			),
			createShift(
				'2',
				null,
				null,
				'佐藤次郎',
				new Date('2025-01-21'),
				14,
				0,
				16,
				0,
				'life-support',
			),
			createShift(
				'3',
				null,
				null,
				'鈴木三郎',
				new Date('2025-01-22'),
				10,
				0,
				12,
				0,
				'commute-support',
			),
		],
		weekStartDate: baseDate,
	},
};
