# 基本スケジュール一覧画面 タスク

## ゴール

- `/admin/basic-schedules` に一覧画面を実装し、新規登録は `/admin/basic-schedules/new` へ移動する。
- 管理者がフィルタと閲覧を行える。
- 編集・削除機能は別タスクとして今回は対象外とする。

## 実装ステップ

### ステップ1: ルーティング整理

- [ ] 1.1. 既存の `/admin/basic-schedules/page.tsx` を `/admin/basic-schedules/new/page.tsx` に移動
- [ ] 1.2. 新しい `/admin/basic-schedules/page.tsx` を作成（一覧用の空ページ）
- [ ] 1.3. 各ページで認可チェック（管理者のみ）が機能することを確認
- [ ] 1.4. ナビゲーションリンクを更新（もし存在する場合）

### ステップ2: データ取得アクションの実装

- [ ] 2.1. `listBasicSchedulesAction` のテストを作成（フィルタパラメータ含む）
- [ ] 2.2. `listBasicSchedulesAction` を実装（weekday/clientId/serviceTypeId/keyword対応）
- [ ] 2.3. Repository層で「曜日 → 開始時刻」昇順ソートを実装
- [ ] 2.4. テストを実行して成功を確認

### ステップ3: 一覧UIコンポーネント（フィルタバー）

- [ ] 3.1. `BasicScheduleFilterBar` コンポーネントのテストを作成
- [ ] 3.2. `BasicScheduleFilterBar` コンポーネントを実装
  - 曜日セレクト
  - 利用者セレクト（契約中のみ）
  - サービス区分セレクト
  - キーワード検索
- [ ] 3.3. Storybook ストーリーを作成（通常、選択済み状態）
- [ ] 3.4. テストを実行して成功を確認

### ステップ4: 一覧UIコンポーネント（テーブル）

- [ ] 4.1. `BasicScheduleTable` コンポーネントのテストを作成
- [ ] 4.2. `BasicScheduleTable` コンポーネントを実装
  - テーブル列: 利用者、サービス区分、曜日、時間帯、担当者、備考
  - 曜日のローカライズ表記
  - 時間帯のフォーマット (HH:MM-HH:MM)
- [ ] 4.3. 空状態コンポーネントを実装
- [ ] 4.4. Storybook ストーリーを作成（通常、空状態、ローディング）
- [ ] 4.5. テストを実行して成功を確認

### ステップ5: 一覧ページの統合

- [ ] 5.1. `/admin/basic-schedules/page.tsx` に一覧ページのテストを作成
- [ ] 5.2. 一覧ページにフィルタバーとテーブルを統合
- [ ] 5.3. `listBasicSchedulesAction` を呼び出してデータ取得
- [ ] 5.4. フィルタ変更時の再取得ロジックを実装
- [ ] 5.5. ローディング/エラー状態の表示を実装
- [ ] 5.6. テストを実行して成功を確認

### ステップ6: 統合テストとStorybookの完成

- [ ] 6.1. 一覧ページの全状態のStorybookストーリーを確認
- [ ] 6.2. フィルタ連動の統合テストを実行
- [ ] 6.3. `pnpm test:ut --run` で全テストが成功することを確認
- [ ] 6.4. アクセシビリティチェック（label、フォーカス順序）
- [ ] 6.5. レスポンシブ表示の確認

## 作業方針 (TDD)

- 各ステップで先にテストを作成し、失敗を確認してから実装
- UI コンポーネントは `src/app/admin/basic-schedules/_components/` 配下に配置
- 各コンポーネントディレクトリに `index.ts` でエクスポート
- Storybook ファイルは `<ComponentName>.stories.tsx` として同ディレクトリに配置

## 受入条件

- 仕様ドキュメントの要件と本タスクのテストがすべて満たされる。
- `pnpm test:ut --run` が成功する。
- 権限チェックが機能し、非管理者はアクセスできない。
