# UC04: 基本スケジュール管理

## 概要

管理者が週次で繰り返される基本スケジュールを登録・編集・削除する。

## アクター

- 管理者（オフィス管理者）

## 事前条件

- 管理者としてログイン済み
- 利用者、スタッフ、サービス区分が登録済み
- 利用者に対する担当許可リスト（ClientStaffAssignment）が設定済み

## 基本フロー

### 基本スケジュール一覧の確認

1. 管理者が `/admin/basic-schedules` にアクセスする
2. 基本スケジュール一覧が表示される
3. 曜日、利用者、サービス区分でフィルタできる

### 基本スケジュールの新規登録

1. 「新規登録」ボタンをクリックする
2. `/admin/basic-schedules/new` に遷移する
3. フォームに入力する
   - 利用者（契約中のみ選択可）
   - サービス区分
   - 曜日
   - 開始時刻、終了時刻
   - 担当者（スタッフピッカーから許可済みスタッフのみ選択可）
   - 備考
4. 「登録」をクリックする
5. 成功トースト表示、一覧にリダイレクト

### 基本スケジュールの編集

1. 一覧から行をクリックする
2. `/admin/basic-schedules/[id]/edit` に遷移する
3. 既存データがフォームに表示される（利用者は変更不可）
4. 内容を変更して「更新」をクリックする
5. 成功トースト表示、一覧にリダイレクト

### 基本スケジュールの削除

1. 編集画面で「削除」ボタンをクリックする
2. 確認ダイアログが表示される
3. 「削除」をクリックする
4. 論理削除（`deleted_at` 設定）される
5. 一覧にリダイレクト

## 代替フロー

### A1: 重複エラー

- 同一スタッフ・同一曜日に時間が重複するスケジュールがある場合
- 「○○さんは△曜日の HH:MM-HH:MM に別の予定があります」エラー表示

### A2: 許可外スタッフ

- 担当許可リストにないスタッフを選択した場合
- エラー表示、登録不可

## 事後条件

- 基本スケジュールがデータベースに反映される
- 週間スケジュール生成時に使用される

## ビジネスルール

- 利用者は `contract_status = active` のみ選択可
- スタッフは `ClientStaffAssignment` に存在する者のみ選択可
- `start_time < end_time`（夜跨ぎは非対応）
- 同一スタッフ・同一曜日で時間重複不可
- 論理削除のみ（物理削除なし）

## 関連

- [基本スケジュール機能](../features/basic-schedule.md)
- [基本スケジュール一覧画面](../screens/admin-basic-schedules.md)
- [基本スケジュール登録画面](../screens/admin-basic-schedules-new.md)
- [基本スケジュール編集画面](../screens/admin-basic-schedules-edit.md)
