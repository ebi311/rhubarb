# UC01: 認証

## 概要

ユーザーが Google アカウントでシステムにログイン/ログアウトする。

## アクター

- 管理者（オフィス管理者）
- ヘルパー（スタッフ）

## 事前条件

- ユーザーの Google アカウントのメールアドレスが `staffs` テーブルに登録済み

## 基本フロー

### ログイン

1. ユーザーが `/login` にアクセスする
2. 「Google でログイン」ボタンをクリックする
3. Google の認証画面でアカウントを選択・認証する
4. システムがコールバック (`/auth/callback`) を受け取る
5. メールアドレスで `staffs` テーブルを検索する
6. スタッフが存在し `auth_user_id` が未設定の場合、紐付けを行う
7. ダッシュボード (`/`) にリダイレクトする

### ログアウト

1. ユーザーがログアウトボタンをクリックする
2. セッションを破棄する
3. `/login` にリダイレクトする

## 代替フロー

### A1: スタッフ未登録

- 手順 5 でスタッフが見つからない場合
- エラーメッセージ「管理者に問い合わせてください」を表示
- ログアウト処理を実行

### A2: 認証済みユーザーのログインページアクセス

- `/login` にアクセス時、認証済みであればダッシュボードにリダイレクト

## 事後条件

- ログイン成功: セッションが確立され、保護されたページにアクセス可能
- ログアウト成功: セッションが破棄され、`/login` 以外のページにアクセス不可

## 関連

- [認証機能](../features/authentication.md)
- [ログイン画面](../screens/login.md)
