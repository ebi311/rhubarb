# UC05: 週間スケジュール管理

## 概要

管理者が基本スケジュールから週間シフトを生成し、変更・キャンセルなどの操作を行う。

## アクター

- 管理者（オフィス管理者）

## 事前条件

- 管理者としてログイン済み
- 基本スケジュールが登録済み

## 基本フロー

### 週間シフトの生成

1. 管理者が `/admin/weekly-schedules` にアクセスする
2. 週を選択する（デフォルトは今週）
3. 「シフトを生成」ボタンをクリックする
4. 基本スケジュールから該当週のシフトが一括生成される
5. 「○件のシフトを生成しました（スキップ: △件）」トースト表示
6. 一覧に生成されたシフトが表示される

### シフト一覧の確認

1. 週を選択する（URL: `/admin/weekly-schedules?week=YYYY-MM-DD`）
2. 該当週のシフト一覧がテーブル表示される
3. 日付、時間、利用者、サービス区分、担当者、ステータスが確認できる

### 担当者の変更

1. シフト行の「担当者変更」ボタンをクリックする
2. ダイアログが開く
3. 新しい担当者をスタッフピッカーから選択する
4. 変更理由を入力（任意）
5. 「変更する」をクリックする
6. 成功トースト表示、一覧に反映

### 未割当シフトへの割り当て

1. 未割当シフト行の「割り当て」ボタンをクリックする
2. ダイアログが開く
3. 担当者をスタッフピッカーから選択する
4. 「割り当てる」をクリックする
5. 成功トースト表示、一覧に反映

### シフトのキャンセル

1. シフト行の「キャンセル」ボタンをクリックする
2. ダイアログが開く
3. キャンセル理由カテゴリを選択（利用者都合 / スタッフ都合 / その他）
4. キャンセル理由を入力（必須）
5. 「キャンセルする」をクリックする
6. ステータスが `canceled` に変更される

### キャンセルの取り消し（復元）

1. キャンセル済みシフト行の「復元」ボタンをクリックする
2. 確認ダイアログが表示される
3. 「復元する」をクリックする
4. ステータスが `scheduled` に戻る

## 代替フロー

### A1: 重複検知

- 担当者変更時、選択したスタッフが同時間帯に他のシフトを持っている場合
- 警告表示、確認後に実行可能

### A2: シフトが存在しない週

- 「この週のシフトはまだありません」メッセージ表示
- 「基本スケジュールから生成」ボタンを表示

## 事後条件

- シフトがデータベースに反映される
- ヘルパーがマイカレンダーで確認可能になる

## ビジネスルール

- 生成は月曜日を基準に週単位で行う
- 既に存在するシフトはスキップ（重複生成しない）
- `completed` 状態のシフトはキャンセル不可

## 関連

- [週間スケジュール機能](../features/weekly-schedule.md)
- [週間スケジュール画面](../screens/admin-weekly-schedules.md)
