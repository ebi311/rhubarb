# 週間スケジュール画面

## 基本情報

| 項目 | 値                                        |
| ---- | ----------------------------------------- |
| URL  | `/admin/weekly-schedules?week=YYYY-MM-DD` |
| 権限 | 管理者のみ                                |

## 目的

週間シフトを生成・閲覧し、担当者変更やキャンセルなどの操作を行う。

## レイアウト

```
┌───────────────────────────────────────────────────────────────────┐
│ [ナビゲーション]                                                   │
├───────────────────────────────────────────────────────────────────┤
│ 週間スケジュール                                                   │
├───────────────────────────────────────────────────────────────────┤
│ [◀ 前週] 2026/01/19 〜 2026/01/25 [次週 ▶]     [シフトを生成]    │
├───────────────────────────────────────────────────────────────────┤
│ 日付       │ 時間        │ 利用者   │ サービス │ 担当者 │ ステータス│ 操作              │
├────────────┼─────────────┼──────────┼──────────┼────────┼───────────┼───────────────────┤
│ 01/19 (月) │ 10:00-11:00 │ 田中太郎 │ 身体介護 │ 山田   │ scheduled │ [担当者変更][キャンセル] │
│ 01/19 (月) │ 14:00-15:00 │ 鈴木花子 │ 生活援助 │ 未割当 │ scheduled │ [割り当て][キャンセル]   │
│ 01/20 (火) │ 09:00-10:00 │ 佐藤三郎 │ 身体介護 │ 田中   │ canceled  │ [復元]                   │
│ ...        │ ...         │ ...      │ ...      │ ...    │ ...       │ ...                      │
└───────────────────────────────────────────────────────────────────┘
```

## 表示項目

### 週選択

| 項目     | 説明                             |
| -------- | -------------------------------- |
| 前週     | 前の週に移動                     |
| 日付範囲 | 表示中の週（月曜〜日曜）         |
| 次週     | 次の週に移動                     |
| 生成     | 基本スケジュールからシフトを生成 |

### テーブル

| 列         | 説明                                         |
| ---------- | -------------------------------------------- |
| 日付       | YYYY/MM/DD (曜日)                            |
| 時間       | HH:MM - HH:MM                                |
| 利用者     | 利用者名                                     |
| サービス   | サービス区分名                               |
| 担当者     | スタッフ名（未割当時は「未割当」バッジ）     |
| ステータス | scheduled / confirmed / completed / canceled |
| 操作       | 状態に応じたアクションボタン                 |

### 操作ボタン表示ルール

| ステータス | 未割当 | ボタン                    |
| ---------- | ------ | ------------------------- |
| scheduled  | true   | [割り当て] [キャンセル]   |
| scheduled  | false  | [担当者変更] [キャンセル] |
| canceled   | -      | [復元]                    |
| completed  | -      | （なし）                  |

## 操作・インタラクション

### 週の選択

1. 前週/次週ボタンまたはカレンダーで週を選択
2. URL パラメータ `week` が更新される
3. 該当週のシフトが表示される

### シフト生成

1. 「シフトを生成」ボタンをクリック
2. `generateWeeklyShiftsAction` 実行
3. 成功 → 「○件生成（△件スキップ）」トースト表示
4. 一覧が更新される

### 担当者変更

1. 「担当者変更」ボタンをクリック
2. ダイアログが開く（現在の情報を表示）
3. 新しい担当者をスタッフピッカーで選択
4. 変更理由を入力（任意）
5. 「変更する」をクリック
6. 成功 → トースト表示、一覧更新

### 割り当て

- 担当者変更と同様（現在の担当者が「未割当」）

### キャンセル

1. 「キャンセル」ボタンをクリック
2. ダイアログが開く
3. キャンセル理由カテゴリを選択（必須）
4. キャンセル理由を入力（必須）
5. 「キャンセルする」をクリック
6. ステータスが `canceled` に変更

### 復元

1. 「復元」ボタンをクリック
2. 確認ダイアログ表示
3. 「復元する」をクリック
4. ステータスが `scheduled` に戻る

## コンポーネント構成

```
src/app/admin/weekly-schedules/
├── page.tsx                        # ページ
├── helpers.ts                      # ヘルパー関数
└── _components/
    ├── WeeklySchedulePage/         # メインコンポーネント
    ├── WeekSelector/               # 週選択
    ├── ShiftTable/                 # シフトテーブル
    ├── GenerateButton/             # 生成ボタン
    ├── ChangeStaffDialog/          # 担当者変更ダイアログ
    ├── CancelShiftDialog/          # キャンセルダイアログ
    └── RestoreShiftDialog/         # 復元確認ダイアログ
```

## URL パラメータ

| パラメータ | 形式       | 説明                 |
| ---------- | ---------- | -------------------- |
| week       | YYYY-MM-DD | 週の開始日（月曜日） |

- 省略時: 今週の月曜日にリダイレクト
- 月曜日以外: エラー表示またはリダイレクト

## 関連

- [週間スケジュール機能](../features/weekly-schedule.md)
- [UC05: 週間スケジュール管理](../use-cases/UC05-weekly-schedule-management.md)
