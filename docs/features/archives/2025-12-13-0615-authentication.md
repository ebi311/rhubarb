# 機能仕様書: Google 認証

## 概要

Supabase Auth を使用した Google アカウントによる認証機能を実装する。
ユーザーは Google アカウントでログインし、システムを利用する。
初回ログイン時に、メールアドレスに基づいて `public.staffs` テーブルのレコードと紐付けを行う。

## 要件

### 1. ログイン

- ログインページ (`/login`) を提供する。
- 「Google でログイン」ボタンを配置する。
- クリックすると Google の認証画面へリダイレクトする。

### 2. 認証コールバック

- Google 認証後のリダイレクト先 (`/auth/callback`) で、Supabase のセッションを確立する。
- 認証されたユーザーのメールアドレスを確認し、`public.staffs` テーブルに該当するメールアドレスを持つスタッフが存在するか確認する。
- **スタッフが存在する場合:**
  - `staffs.auth_user_id` が未設定であれば、現在の `user.id` を設定して紐付ける。
  - ダッシュボード（トップページ）へリダイレクトする。
- **スタッフが存在しない場合:**
  - ログインを拒否し、エラー画面または「管理者に問い合わせてください」というメッセージを表示してログアウトさせる。

### 3. ログアウト

- ログアウト機能を提供する。
- ログアウト後はログインページへリダイレクトする。

### 4. ルート保護 (Middleware)

- 未認証ユーザーが保護されたページ（ログインページ以外）にアクセスした場合、ログインページへリダイレクトする。
- 認証済みユーザーがログインページにアクセスした場合、ダッシュボードへリダイレクトする。

## UI/UX

- シンプルなログインカード。
- daisyUI のコンポーネントを使用。

## セキュリティ

- Supabase の RLS (Row Level Security) は、`auth.uid()` を使用して制御する（既存のポリシーを確認・更新する必要があるかもしれない）。
