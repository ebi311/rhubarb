# Issue #14: ヘッダのメニュー改善 - 実装計画

**作成日**: 2026-02-07
**対象Issue**: [#14 ヘッダのメニュー改善](https://github.com/ebi311/rhubarb/issues/14)
**ステータス**: 計画中

---

## 1. 概要

### 現状

- 左側：ロゴ + ページタイトル
- 右側：「スタッフ管理」リンク、「利用者管理」リンク、UserMenu（ユーザー名ドロップダウン）

### 変更後

- 左側：ロゴ + ページタイトル
- 右側：NavigationMenu（新規）、UserMenu

---

## 2. 実装対象ファイル

### 新規作成

| ファイル                                                               | 説明               |
| ---------------------------------------------------------------------- | ------------------ |
| `src/app/_components/Header/NavigationMenu/NavigationMenu.tsx`         | コンポーネント本体 |
| `src/app/_components/Header/NavigationMenu/NavigationMenu.test.tsx`    | ユニットテスト     |
| `src/app/_components/Header/NavigationMenu/NavigationMenu.stories.tsx` | Storybook          |
| `src/app/_components/Header/NavigationMenu/index.ts`                   | named export       |

### 変更

| ファイル                                              | 変更内容                           |
| ----------------------------------------------------- | ---------------------------------- |
| `src/app/_components/Header/HeaderPresentational.tsx` | 個別リンク削除、NavigationMenu追加 |
| `src/app/_components/Header/Header.test.tsx`          | 個別リンクのテストを削除/変更      |

---

## 3. 技術設計

### 3.1 NavigationMenuコンポーネント設計

daisyUIの`details`要素ベースのドロップダウンを使用（UserMenuと同じパターン）。

```tsx
// NavigationMenu.tsx の基本構造
import Link from 'next/link';
import { Icon } from '@/app/_components/Icon';

export const NavigationMenu = () => {
	return (
		<details className="dropdown dropdown-end">
			<summary className="btn btn-ghost">
				<Icon name="menu" />
				メニュー
			</summary>
			<ul className="dropdown-content menu z-10 w-52 rounded-box border border-base-300 bg-base-100 p-2 shadow">
				<li>
					<Link href="/">ダッシュボード</Link>
				</li>
				<li>
					<Link href="/admin/weekly-schedules">週次スケジュール</Link>
				</li>
				<li>
					<Link href="/admin/basic-schedules">基本スケジュール</Link>
				</li>
				<li></li> {/* divider - 空のliがdaisyUIでdividerになる */}
				<li>
					<Link href="/admin/clients">利用者管理</Link>
				</li>
				<li>
					<Link href="/admin/staffs">スタッフ管理</Link>
				</li>
			</ul>
		</details>
	);
};
```

### 3.2 メニュー項目定義

\

```tsx
type MenuItem = {
	label: string;
	href: string;
};

type MenuGroup = MenuItem[];

const MENU_ITEMS: MenuGroup[] = [
	[
		{ label: 'ダッシュボード', href: '/' },
		{ label: '週次スケジュール', href: '/admin/weekly-schedules' },
		{ label: '基本スケジュール', href: '/admin/basic-schedules' },
	],
	[
		{ label: '利用者管理', href: '/admin/clients' },
		{ label: 'スタッフ管理', href: '/admin/staffs' },
	],
];
```

### 3.3 HeaderPresentational 変更

```tsx
// Before
<div className="flex-none">
  <Link href="/admin/staffs" className="btn btn-ghost btn-sm">
    スタッフ管理
  </Link>
  <Link href="/admin/clients" className="btn btn-ghost btn-sm">
    利用者管理
  </Link>
  <UserMenu userName={userName} />
</div>

// After
<div className="flex-none">
  <NavigationMenu />
  <UserMenu userName={userName} />
</div>
```

---

## 4. TDD実装手順

### フェーズ1: NavigationMenu テスト作成（RED）

1. **テストファイル作成**: `NavigationMenu.test.tsx`
2. **テストケース**:
   - メニューボタンが表示される
   - ドロップダウン内に全メニュー項目が存在する
   - 各メニュー項目が正しいhref属性を持つ
   - divider（区切り線）が存在する

```tsx
// テストケース例
describe('NavigationMenu', () => {
	it('メニューボタンが表示される', () => {
		render(<NavigationMenu />);
		expect(screen.getByRole('group')).toBeInTheDocument(); // details要素
	});

	it('ダッシュボードへのリンクが表示される', () => {
		render(<NavigationMenu />);
		const link = screen.getByRole('link', { name: 'ダッシュボード' });
		expect(link).toHaveAttribute('href', '/');
	});

	it('週次スケジュールへのリンクが表示される', () => {
		render(<NavigationMenu />);
		const link = screen.getByRole('link', { name: '週次スケジュール' });
		expect(link).toHaveAttribute('href', '/admin/weekly-schedules');
	});

	// ... 他のリンクも同様
});
```

### フェーズ2: NavigationMenu 実装（GREEN）

1. **NavigationMenu.tsx** 作成
2. **index.ts** 作成
3. テスト実行して全て通ることを確認

### フェーズ3: Storybook 作成

1. **NavigationMenu.stories.tsx** 作成
2. バリエーション：
   - `Default`: 基本表示

### フェーズ4: HeaderPresentational 変更

1. 既存テストの更新（個別リンクのテストを削除）
2. NavigationMenuへの参照を確認するテスト追加
3. HeaderPresentational.tsx を変更

### フェーズ5: リファクタリング（REFACTOR）

1. コードレビュー
2. 必要に応じてテスト追加

---

## 5. 詳細テストケース

### NavigationMenu.test.tsx

| #   | テストケース               | 期待結果                          |
| --- | -------------------------- | --------------------------------- |
| 1   | メニューボタンが表示される | `details`要素（group role）が存在 |
| 2   | ダッシュボードリンク       | href="/"                          |
| 3   | 週次スケジュールリンク     | href="/admin/weekly-schedules"    |
| 4   | 基本スケジュールリンク     | href="/admin/basic-schedules"     |
| 5   | 利用者管理リンク           | href="/admin/clients"             |
| 6   | スタッフ管理リンク         | href="/admin/staffs"              |
| 7   | メニュー項目数の確認       | 5つのリンクが存在                 |

### Header.test.tsx 更新

| #   | 変更 | 詳細                                             |
| --- | ---- | ------------------------------------------------ |
| 1   | 削除 | 「ユーザーメンテナンスリンクが表示される」テスト |
| 2   | 削除 | 「利用者管理リンクが表示される」テスト           |

---

## 6. Storybook バリエーション

### NavigationMenu.stories.tsx

```tsx
import type { Meta, StoryObj } from '@storybook/nextjs-vite';
import { NavigationMenu } from './NavigationMenu';

const meta: Meta<typeof NavigationMenu> = {
	title: 'App/Header/NavigationMenu',
	component: NavigationMenu,
	parameters: {
		layout: 'centered',
	},
	tags: ['autodocs'],
};

export default meta;
type Story = StoryObj<typeof NavigationMenu>;

export const Default: Story = {};

export const InNavbar: Story = {
	decorators: [
		(Story) => (
			<div className="navbar bg-base-100">
				<div className="flex-none">
					<Story />
				</div>
			</div>
		),
	],
};
```

---

## 7. 実装チェックリスト

### 準備

- [ ] feature/issue-14-header-navigation-menu ブランチ作成
- [ ] main（またはdevelop）から最新を取得

### 実装

- [ ] `NavigationMenu/` ディレクトリ作成
- [ ] `NavigationMenu.test.tsx` 作成（テストファースト）
- [ ] `NavigationMenu.tsx` 実装
- [ ] `index.ts` 作成
- [ ] `NavigationMenu.stories.tsx` 作成
- [ ] テスト実行確認

### 統合

- [ ] `Header.test.tsx` 更新（個別リンクテスト削除）
- [ ] `HeaderPresentational.tsx` 変更
- [ ] 全テスト実行確認
- [ ] Storybook 確認

### 受け入れ基準確認

- [ ] NavigationMenuコンポーネントが作成されている
- [ ] ドロップダウンメニューがヘッダ右側（ユーザー名の左隣）に配置されている
- [ ] メニューをクリックするとドロップダウンが開く
- [ ] 各メニュー項目をクリックすると対応するページに遷移する
- [ ] 区切り線（divider）で管理メニューが区切られている
- [ ] 既存の個別リンクがヘッダから削除されている
- [ ] Storybook でコンポーネントが確認できる
- [ ] ユニットテストが作成されている

---

## 8. 参考情報

### 既存パターン

- `UserMenu/` コンポーネントの構造を参考
- daisyUIの`details`+`dropdown`パターン
- `Icon` コンポーネント（`menu`アイコン利用可能）

### daisyUIクラス

- `dropdown`, `dropdown-end`: ドロップダウン配置
- `dropdown-content`: ドロップダウン内容
- `menu`: メニュースタイル
- 空の`<li>`: divider（区切り線）

### 関連ドキュメント

- [daisyUI Dropdown](https://daisyui.com/components/dropdown/)
- [daisyUI Menu](https://daisyui.com/components/menu/)
- [daisyUI Divider](https://daisyui.com/components/divider/)

---

## 9. 見積もり工数

| フェーズ | 作業                       | 見積もり        |
| -------- | -------------------------- | --------------- |
| 1        | NavigationMenu テスト作成  | 15分            |
| 2        | NavigationMenu 実装        | 20分            |
| 3        | Storybook 作成             | 10分            |
| 4        | Header変更・テスト更新     | 15分            |
| 5        | 動作確認・リファクタリング | 15分            |
| **合計** |                            | **約1時間15分** |
