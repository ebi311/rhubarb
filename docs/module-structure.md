## 💡 論理的なモジュール構造案

このシステムは、MVP の機能（特に AI による変更・調整）と非機能要件（リアルタイム性、セキュリティ、拡張性）を満たすため、**「レイヤードアーキテクチャ」**を採用します。システムは主に、**インターフェース層**、**アプリケーション層**、**ドメイン層**、**インフラストラクチャ層**の 4 層で構成されます。

---

### 1. インターフェース層 (Presentation Layer)

ユーザーが直接触れる部分です。シンプルさとリアルタイム性、モバイル対応が重要です。

| モジュール名           | 役割                                                                                                                     | MVP 対応機能                                                                                                     |
| :--------------------- | :----------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------- |
| **管理者 Web UI**      | 管理者がスケジュール登録、変更、AI シミュレーション操作を行うためのブラウザベースのインターフェース。                    | 基本スケジュール登録、変更登録（ドラッグ＆ドロップ）、ビュー切り替え（担当者/利用者）、AI シミュレーション起動。 |
| **ヘルパー Mobile UI** | ヘルパーがスマートフォンからアクセスするインターフェース（PWA 推奨）。閲覧専用。                                         | **リアルタイム・マイカレンダー**、変更の自動通知（プッシュ通知の受信）。                                         |
| **API Gateway**        | 各 UI からのリクエストを受け付け、後続のアプリケーションサービスにルーティングし、セキュリティ（認証・認可）を担保する。 | ヘルパー認証、管理者認証。                                                                                       |

---

### 2. アプリケーション層 (Application Layer)

ドメイン層のビジネスロジックを組み合わせて、ユースケース（機能）を実現する層です。トランザクション管理やセキュリティチェックも行います。

| モジュール名                 | 役割                                                                                                         | MVP 対応機能                                                      |
| :--------------------------- | :----------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------- |
| **スケジュール管理サービス** | スケジュールの CRUD 操作（作成、読み込み、更新、削除）を担う主要サービス。                                   | スケジュールの永続化、変更の自動通知トリガー。                    |
| **ユーザ・認証サービス**     | ヘルパーおよび管理者の認証・認可を管理する。                                                                 | ヘルパーの ID/パスワード認証、管理者のログイン管理。              |
| **AI 最適化実行サービス**    | 管理者からのシミュレーション要求を受けて、**シフト調整ロジック（ドメイン層）**を呼び出し、結果を UI に返す。 | **AI 代行者シミュレーション**、**負荷バランサー警告**の計算実行。 |

---

### 3. ドメイン層 (Domain Layer)

プロダクトの最も重要な価値（コアビジネスロジック）をカプセル化する層です。拡張性・保守性、特に**AI による差別化の核**をここに分離します。

| モジュール名                 | 役割                                                                                                               | 関連するドメインエンティティ                                               |
| :--------------------------- | :----------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------- |
| **シフト調整ロジック**       | 欠員発生時の最適な代行者選定、負荷平準化、玉突き変更のシミュレーションロジックを実装。**プロダクトの差別化の核。** | サービス枠、ヘルパー、利用者、スキル/資格（シンプル版）                    |
| **スケジューリングポリシー** | 業務時間インターバルや労働時間の制約、特定の利用者とヘルパーの固定アサインルールなどを管理。                       | スケジュール変更履歴、負荷実績。                                           |
| **コアエンティティ**         | システムが扱う主要なデータモデル（オブジェクト）とその不変条件を定義。                                             | **サービス枠（シフト）**、**ヘルパー**、**利用者**、**事務所（テナント）** |

---

### 4. インフラストラクチャ層 (Infrastructure Layer)

データの永続化、外部連携、メッセージングなど、技術的な詳細を担う層です。

| モジュール名              | 役割                                                                                             | 非機能要件対応                                        |
| :------------------------ | :----------------------------------------------------------------------------------------------- | :---------------------------------------------------- |
| **データベース**          | スケジュールデータ、利用者・ヘルパー情報の永続化。高い信頼性と正確性（データ保全）が求められる。 | RDB 推奨（PostgreSQL など）。**信頼性**、**正確性**。 |
| **通知/メッセージキュー** | リアルタイムの変更通知をヘルパーに確実に届けるための非同期処理。                                 | **変更の自動通知**、**成熟性（安定稼働）**。          |
| **外部連携モジュール**    | データインポート（CSV など）や、将来的な API 連携のための基盤。                                  | **基本スケジュール登録**（初期データ取り込み）。      |
